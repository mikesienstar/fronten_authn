(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();function l(e){const t=new Uint8Array(e);let r="";for(const n of t)r+=String.fromCharCode(n);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function m(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4,o=t.padEnd(t.length+r,"="),n=atob(o),i=new ArrayBuffer(n.length),a=new Uint8Array(i);for(let d=0;d<n.length;d++)a[d]=n.charCodeAt(d);return i}function E(){return(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function"}function A(e){const{id:t}=e;return{...e,id:m(t),transports:e.transports}}function S(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class s extends Error{constructor({message:t,code:r,cause:o,name:n}){super(t,{cause:o}),this.name=n??o.name,this.code=r}}function I({error:e,options:t}){var o,n;const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new s({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((o=r.authenticatorSelection)==null?void 0:o.requireResidentKey)===!0)return new s({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(((n=r.authenticatorSelection)==null?void 0:n.userVerification)==="required")return new s({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new s({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new s({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return r.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new s({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new s({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const i=window.location.hostname;if(S(i)){if(r.rp.id!==i)return new s({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new s({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new s({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new s({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}class T{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const _=new T,C=["cross-platform","platform"];function O(e){if(e&&!(C.indexOf(e)<0))return e}async function D(e){var g;if(!E())throw new Error("WebAuthn is not supported in this browser");const r={publicKey:{...e,challenge:m(e.challenge),user:{...e.user,id:m(e.user.id)},excludeCredentials:(g=e.excludeCredentials)==null?void 0:g.map(A)}};r.signal=_.createNewAbortSignal();let o;try{o=await navigator.credentials.create(r)}catch(c){throw I({error:c,options:r})}if(!o)throw new Error("Registration was not completed");const{id:n,rawId:i,response:a,type:d}=o;let f;typeof a.getTransports=="function"&&(f=a.getTransports());let w;if(typeof a.getPublicKeyAlgorithm=="function")try{w=a.getPublicKeyAlgorithm()}catch(c){y("getPublicKeyAlgorithm()",c)}let h;if(typeof a.getPublicKey=="function")try{const c=a.getPublicKey();c!==null&&(h=l(c))}catch(c){y("getPublicKey()",c)}let p;if(typeof a.getAuthenticatorData=="function")try{p=l(a.getAuthenticatorData())}catch(c){y("getAuthenticatorData()",c)}return{id:n,rawId:l(i),response:{attestationObject:l(a.attestationObject),clientDataJSON:l(a.clientDataJSON),transports:f,publicKeyAlgorithm:w,publicKey:h,authenticatorData:p},type:d,clientExtensionResults:o.getClientExtensionResults(),authenticatorAttachment:O(o.authenticatorAttachment)}}function y(e,t){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,t)}function v(){if(!E())return new Promise(t=>t(!1));const e=window.PublicKeyCredential;return e.isConditionalMediationAvailable===void 0?new Promise(t=>t(!1)):e.isConditionalMediationAvailable()}function N({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new s({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new s({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const o=window.location.hostname;if(S(o)){if(r.rpId!==o)return new s({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new s({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new s({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function K(e,t=!1){var p,g;if(!E())throw new Error("WebAuthn is not supported in this browser");let r;((p=e.allowCredentials)==null?void 0:p.length)!==0&&(r=(g=e.allowCredentials)==null?void 0:g.map(A));const o={...e,challenge:m(e.challenge),allowCredentials:r},n={};if(t){if(!await v())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');n.mediation="conditional",o.allowCredentials=[]}n.publicKey=o,n.signal=_.createNewAbortSignal();let i;try{i=await navigator.credentials.get(n)}catch(c){throw N({error:c,options:n})}if(!i)throw new Error("Authentication was not completed");const{id:a,rawId:d,response:f,type:w}=i;let h;return f.userHandle&&(h=l(f.userHandle)),{id:a,rawId:l(d),response:{authenticatorData:l(f.authenticatorData),clientDataJSON:l(f.clientDataJSON),signature:l(f.signature),userHandle:h},type:w,clientExtensionResults:i.getClientExtensionResults(),authenticatorAttachment:O(i.authenticatorAttachment)}}const U=document.querySelector("[data-signup]"),L=document.querySelector("[data-login]"),P=document.querySelector("[data-email]"),b=document.querySelector("[data-modal]"),M=document.querySelector("[data-close]");U.addEventListener("click",B);L.addEventListener("click",$);M.addEventListener("click",()=>b.close());const R="https://figerprint-auther-backend.onrender.com";async function B(){const e=P.value.trim();if(!e){u("Please enter a valid email");return}try{const t=await fetch(`${R}/init-register?email=${encodeURIComponent(e)}`,{credentials:"include"}),r=await t.json();if(!t.ok){u(r.error||"Failed to start registration");return}const o=await D(r),n=await fetch(`${R}/verify-register`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),i=await n.json();if(!n.ok){u(i.error||"Verification failed");return}u(i.verified?`Success! ${e} registered`:"Registration failed")}catch(t){console.error("Signup error:",t),u(t.message.includes("base64URLString")?"Browser error: Try a different browser or device":"An unexpected error occurred")}}async function $(){const e=P.value,t=await fetch(`${R}/init-auth?email=${e}`,{credentials:"include"}),r=await t.json();t.ok||u(r.error);const o=await K(r),n=await fetch(`${R}/verify-auth`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),i=await n.json();n.ok||u(i.error),i.verified?u(`Successfully logged in ${e}`):u("Failed to log in")}function u(e){b.querySelector("[data-content]").innerText=e,b.showModal()}
